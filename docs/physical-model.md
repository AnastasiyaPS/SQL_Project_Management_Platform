# Physical Model (Физическая модель БД)

## СУБД
PostgreSQL 15

Физическая модель базы данных реализована с использованием возможностей PostgreSQL,
включая ограничения целостности, индексы, представления и хранимые процедуры.

---

## Таблицы и структура

### Project (Проект)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| project_id (PK) | SERIAL | Уникальный идентификатор проекта |
| project_name | VARCHAR(100) NOT NULL | Название проекта |
| project_description | TEXT | Описание проекта |
| start_date | DATE NOT NULL | Дата начала проекта |
| end_date | DATE | Дата завершения проекта |

**Ограничения:**
- CHECK: `end_date >= start_date` или `end_date IS NULL`

---

### Users (Пользователи)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| user_id (PK) | SERIAL | Уникальный идентификатор пользователя |
| full_name | VARCHAR(100) NOT NULL | ФИО пользователя |
| email | VARCHAR(100) UNIQUE NOT NULL | Электронная почта |
| role | VARCHAR(50) | Роль пользователя в системе |

**Ограничения:**
- CHECK: корректность email

---

### Task (Задачи)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| task_id (PK) | SERIAL | Уникальный идентификатор задачи |
| project_id (FK) | INTEGER | Проект, к которому относится задача |
| assigned_user_id (FK) | INTEGER | Назначенный исполнитель |
| current_status_id (FK) | INTEGER | Текущий статус задачи |
| title | VARCHAR(200) NOT NULL | Название задачи |
| description | TEXT | Описание задачи |
| created_at | TIMESTAMP | Дата создания |
| due_date | DATE | Срок выполнения |

**Ограничения:**
- FOREIGN KEY `project_id` → `project`
- FOREIGN KEY `assigned_user_id` → `users` (ON DELETE SET NULL)
- FOREIGN KEY `current_status_id` → `status`
- CHECK: `due_date >= created_at`

---

### Status (Статусы задач)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| status_id (PK) | SERIAL | Уникальный идентификатор статуса |
| status_name | VARCHAR(50) UNIQUE NOT NULL | Название статуса |

---

### Comments (Комментарии)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| comment_id (PK) | SERIAL | Уникальный идентификатор комментария |
| task_id (FK) | INTEGER | Задача |
| user_id (FK) | INTEGER | Автор комментария |
| comment_text | TEXT NOT NULL | Текст комментария |
| created_at | TIMESTAMP | Дата создания |

**Ограничения:**
- Каскадное удаление при удалении задачи или пользователя

---

### Tag (Теги)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| tag_id (PK) | SERIAL | Уникальный идентификатор тега |
| tag_name | VARCHAR(50) UNIQUE NOT NULL | Название тега |

---

## Таблицы связей (M:M)

### Task_Tags (Связь задач и тегов)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| task_id (FK) | INTEGER | Идентификатор задачи |
| tag_id (FK) | INTEGER | Идентификатор тега |

**Первичный ключ:** `(task_id, tag_id)`

---

### Project_Users (Участники проектов)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| project_id (FK) | INTEGER | Идентификатор проекта |
| user_id (FK) | INTEGER | Идентификатор пользователя |
| project_role | VARCHAR(50) | Роль пользователя в проекте |

**Первичный ключ:** `(project_id, user_id)`

---

## Версионные данные (SCD Type 2)

### Task_Status_History (История статусов задач)

| Атрибут | Тип | Описание |
|-------|-----|----------|
| task_status_history_id (PK) | SERIAL | Уникальный идентификатор записи |
| task_id (FK) | INTEGER | Идентификатор задачи |
| status_id (FK) | INTEGER | Идентификатор статуса |
| valid_from | TIMESTAMP | Начало действия статуса |
| valid_to | TIMESTAMP | Окончание действия статуса |
| is_current | BOOLEAN | Признак текущего статуса |

**Ограничения:**
- UNIQUE INDEX: только один текущий статус на задачу

---

## Индексы
Созданы индексы для:
- поиска задач по проекту
- поиска задач пользователя
- фильтрации по статусу
- анализа сроков выполнения
- ускорения работы с историей статусов

---

## Процедуры и представления
Физическая модель включает:
- процедуры для создания задач и смены статусов
- представления для текущих, просроченных задач и истории статусов

---

## Итог
Физическая модель полностью реализует логическую модель системы
и обеспечивает целостность, производительность и расширяемость базы данных.
